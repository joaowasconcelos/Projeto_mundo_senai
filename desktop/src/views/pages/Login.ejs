<link rel="stylesheet" href="/css/Login.css">

<div class="login-container">
    <h2>Login</h2>
    <% if (error_msg) { %>
        <div class="alert alert-danger"><%= error_msg %></div>
    <% } %>
    
    <form id="loginForm" action="/auth/login" method="post">
        <!-- Input de Login -->
        <% if (typeof resultl !=='undefined' ) { %>
            <input type="text" id="login" placeholder="Login" name="login" value="<%= resultl %>" required>
            <% } else { %>
                <input type="text" id="login" placeholder="Login" name="login" required>
                <% } %>

                    <!-- Input de Senha -->
                    <% if (typeof results !=='undefined' ) { %>
                        <input type="password" id="senha" placeholder="Senha" name="senha" value="<%= results %>"
                            required>
                        <% } else { %>
                            <input type="password" id="senha" placeholder="Senha" name="senha" required>
                            <% } %>

                                <button type="submit" id="loginButton">Login</button>
    </form>
</div>

<!-- Modal -->
<% if (typeof firstObject !=='undefined' || typeof secondObject !=='undefined' ) { %>
    <div id="myModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h3>Deseja logar como:</h3>
            <button class="login-option" id="firstObjectBtn" value="<%= firstObject %>">
                <%= firstObject %>
            </button>
            <% if (typeof secondObject !=='undefined' ) { %>
                <p class="or-divider">OU</p>
                <button class="login-option" id="secondObjectBtn" value="<%= secondObject %>">
                    <%= secondObject %>
                </button>
                <% } %>
                    <% if (typeof thirdObject !=='undefined' ) { %>
                        <script>console.log("aqqq", thirdObject)</script>
                        <p class="or-divider">OU</p>
                        <button class="login-option" id="thirdObjectBtn" value="<%= thirdObject %>">
                            <%= thirdObject %>
                        </button>
                        <% } %>

        </div>
        <script>
            var modal = document.getElementById('myModal');
            modal.style.display = "block";

            var firstObjectBtn = document.getElementById('firstObjectBtn');
            var secondObjectBtn = document.getElementById('secondObjectBtn');
            var thirdObjectBtn = document.getElementById('thirdObjectBtn');

            if (firstObjectBtn !== null) {
                firstObjectBtn.addEventListener('click', function () {
                    selecionarTipoLogin(firstObjectBtn.value);
                });
            }
            if (secondObjectBtn !== null) {
                secondObjectBtn.addEventListener('click', function () {
                    selecionarTipoLogin(secondObjectBtn.value);
                });
            }
            if (thirdObjectBtn !== null) {
                thirdObjectBtn.addEventListener('click', function () {
                    selecionarTipoLogin(thirdObjectBtn.value);
                });
            }

            function selecionarTipoLogin(tipo) {
                // Enviar a seleção via fetch para o servidor
                fetch('/direcionaLogin', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ tipo: tipo })
                })
                    .then(response => {
                        if (response.ok) {
                            window.location.href = response.url; // Redirecionar após o login
                        } else {
                            console.error('Erro ao direcionar após login:', response.status);
                            alert('Erro ao fazer login. Tente novamente.');
                        }
                    })
                    .catch(error => {
                        console.error('Erro ao fazer login:', error);
                        alert('Erro ao fazer login. Tente novamente.');
                    });
            }
        </script>
        <% } %>

            <script>
                // JavaScript para controlar o modal
                var modal = document.getElementById('myModal');
                var span = document.getElementsByClassName("close")[0];

                span.onclick = function () {
                    modal.style.display = "none";
                }

                window.onclick = function (event) {
                    if (event.target == modal) {
                        modal.style.display = "none";
                    }
                }
            </script>