<link rel="stylesheet" href="/css/PacienteInfo.css">

<a href="/adm">
    <button class="button">
        <div class="button-box">
            <span class="button-elem">
                <svg viewBox="0 0 46 40" xmlns="http://www.w3.org/2000/svg">
                    <path
                        d="M46 20.038c0-.7-.3-1.5-.8-2.1l-16-17c-1.1-1-3.2-1.4-4.4-.3-1.2 1.1-1.2 3.3 0 4.4l11.3 11.9H3c-1.7 0-3 1.3-3 3s1.3 3 3 3h33.1l-11.3 11.9c-1 1-1.2 3.3 0 4.4 1.2 1.1 3.3.8 4.4-.3l16-17c.5-.5.8-1.1.8-1.9z">
                    </path>
                </svg>
            </span>
            <span class="button-elem">
                <svg viewBox="0 0 46 40">
                    <path
                        d="M46 20.038c0-.7-.3-1.5-.8-2.1l-16-17c-1.1-1-3.2-1.4-4.4-.3-1.2 1.1-1.2 3.3 0 4.4l11.3 11.9H3c-1.7 0-3 1.3-3 3s1.3 3 3 3h33.1l-11.3 11.9c-1 1-1.2 3.3 0 4.4 1.2 1.1 3.3.8 4.4-.3l16-17c.5-.5.8-1.1.8-1.9z">
                    </path>
                </svg>
            </span>
        </div>
    </button>
</a>

<div class="paciente-container">
    <h2 class="titulo">Todos os Dados dos Pacientes</h2>

    <% infoPaciente.forEach(function(item) { %>
        <div class="paciente-item">

            <input type="hidden" value="<%= item.id %>" id="id">

            <label>Nome:</label>
            <input type="text" value="<%= item.Nome %>" readonly>

            <label>CPF:</label>
            <input type="text" value="<%= item.CPF %>" readonly>

            <label>Data de Nascimento:</label>
            <input type="text" value="<%= item.DataNascimento %>" readonly>

            <label>Gênero:</label>
            <input type="text" value="<%= item.Genero %>" readonly>

            <label>Email:</label>
            <input type="text" value="<%= item.Email %>" readonly>

            <label>Data de Cadastro:</label>
            <input type="text" value="<%= item.DataCadastro %>" readonly>

            <label>Logradouro:</label>
            <input type="text" value="<%= item.Logradouro %>" readonly>

            <label>Bairro:</label>
            <input type="text" value="<%= item.Bairro %>" readonly>

            <label>Estado:</label>
            <input type="text" value="<%= item.Estado %>" readonly>

            <label>Número Residencial:</label>
            <input type="text" value="<%= item.NumeroResidencia %>" readonly>

            <label>Complemento:</label>
            <input type="text" value="<%= item.Complemento %>" readonly>

            <label>CEP:</label>
            <input type="text" value="<%= item.CEP %>" readonly>

            <label>Telefone:</label>
            <input type="text" value="<%= item.Telefone %>" readonly>

            <label>Tipo:</label>
            <input type="text" value="<%= item.Tipo %>" readonly>

            <label>Login:</label>
            <input type="text" value="<%= item.Login %>" readonly>

            <label>Senha:</label>
            <input type="text" value="<%= item.Senha %>" readonly>

            <label>Data de Admissão:</label>
            <input type="text" value="<%= item.DataAdmissao %>" readonly>

            <label>CRM:</label>
            <input type="text" value="<%= item.CRM %>" readonly>

            <label>Especialidade:</label>
            <input type="text" value="<%= item.Especialidade %>" readonly>
        </div>
        <% infoPaciente.forEach(function(item) { %>
</div>

<div class="botoes">
    <div>
        <a href="/Paciente" class="back-button">
            <button><span class="material-symbols-outlined">arrow_back</span> Voltar</button>
        </a>
    </div>
    <div class="button-container">
        <a href="#" class="edit-button">
            <button><span class="material-symbols-outlined">edit</span> Editar</button>
        </a>
    </div>
    <div class="button-container">
        <a href="#" class="delete-button">
            <button><span class="material-symbols-outlined">delete</span> Deletar</button>
        </a>
    </div>
</div>

<!-- Modal de confirmação -->
<div id="confirmDeleteModal" class="modal">
    <div class="modal-content">
        <p>Tem certeza que deseja deletar esta pessoa?</p>
        <button id="confirmDeleteButton">Confirmar</button>
        <button id="cancelDeleteButton">Cancelar</button>
    </div>
</div>


<script>
    document.addEventListener('DOMContentLoaded', function () {
        const deleteButtons = document.querySelectorAll('.delete-button');
        const confirmDeleteModal = document.getElementById('confirmDeleteModal');
        const confirmDeleteButton = document.getElementById('confirmDeleteButton');
        const cancelDeleteButton = document.getElementById('cancelDeleteButton');
        const idPessoa = document.getElementById("id").value


        // Event listener para cada botão de delete
        deleteButtons.forEach(button => {
            button.addEventListener('click', function (event) {
                event.preventDefault();
                confirmDeleteModal.style.display = 'block'; // Exibir modal de confirmação
            });
        });

        // Event listener para o botão de confirmar no modal
        confirmDeleteButton.addEventListener('click', function () {
            // Enviar requisição DELETE usando fetch
            fetch(`/deletar/pessoa/${idPessoa}`, {
                method: 'DELETE',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
                .then(response => {
                    console.log(response)
                    if (response.ok) {
                        alert('Pessoa deletada com sucesso!');
                        confirmDeleteModal.style.display = 'none'; // Esconder modal após a ação
                        window.history.back(); // Voltar uma página
                        window.location.reload();
                    } else {
                        alert('Erro ao deletar dados da pessoa.');
                    }
                })
                .catch(error => {
                    console.error('Erro:', error);
                    alert('Erro ao deletar dados da pessoa.');
                });

            confirmDeleteModal.style.display = 'none'; // Esconder modal após a ação
        });

        // Event listener para o botão de cancelar no modal
        cancelDeleteButton.addEventListener('click', function () {
            confirmDeleteModal.style.display = 'none'; // Esconder modal se o usuário cancelar
        });
    });
</script>